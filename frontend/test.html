<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>WebSocket Matchmaking Test</title>
</head>
<body>
  <h2>WebSocket Test</h2>
  <button onclick="connect()">Connect & Find Match</button>
  <pre id="log"></pre>

  <script>
    let socket;

    function log(msg) {
      document.getElementById("log").textContent += msg + "\n";
    }

    function connect() {
      fetch("http://localhost:8080/api/nickname", { credentials: "include" })
        .then(res => res.json())
        .then(data => {
          log("Your nickname: " + data.nickname);

          socket = new WebSocket("ws://localhost:8080/ws");

          socket.onopen = () => {
            log("WebSocket connected");
            socket.send(JSON.stringify({ type: "find_match" }));
          };

          socket.onmessage = (event) => {
            log("FROM SERVER: " + event.data);
          };

          socket.onclose = () => log("WebSocket closed");
          socket.onerror = (err) => log("WebSocket error: " + err);
        })
        .catch(err => {
          log("Error: " + err);
        });
    }
  </script>
</body>
</html>
