<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f4f7f9;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }
        
        h1 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .user-info {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f1f8ff;
            border-radius: 8px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            padding: 10px 15px;
            background-color: #e9f5f8;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .primary-btn {
            background-color: #3498db;
            color: white;
        }
        
        .primary-btn:hover {
            background-color: #2980b9;
        }
        
        .secondary-btn {
            background-color: #ecf0f1;
            color: #2c3e50;
        }
        
        .secondary-btn:hover {
            background-color: #bdc3c7;
        }
        
        .danger-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .danger-btn:hover {
            background-color: #c0392b;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 0 auto;
            max-width: 300px;
        }
        
        .cell {
            width: 100%;
            aspect-ratio: 1/1;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .cell:hover {
            background-color: #e9ecef;
        }
        
        .cell.x {
            color: #3498db;
        }
        
        .cell.o {
            color: #e74c3c;
        }
        
        .status-message {
            margin: 20px 0;
            font-size: 18px;
            min-height: 27px;
        }
        
        .loader {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .modal-message {
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .score-board {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .score-item {
            text-align: center;
        }
        
        .score-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .score-label {
            font-size: 14px;
            color: #6c757d;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #2ecc71;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            z-index: 1000;
        }
        
        .notification.error {
            background-color: #e74c3c;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Page -->
        <div id="main-page">
            <h1>Tic-Tac-Toe</h1>
            
            <div class="user-info">
                <p>Your nickname: <span id="user-nickname">Loading...</span></p>
            </div>
            
            <div class="stats">
                <div id="online-users-stat" class="stat-box">
                    <span id="online-users-count">0</span> users online
                </div>
                <div id="active-games-stat" class="stat-box">
                    <span id="active-games-count">0</span> games in progress
                </div>
            </div>
            
            <div class="buttons">
                <button id="quick-game-btn" class="primary-btn">Quick Game</button>
                <button id="offline-game-btn" class="secondary-btn">Offline Game</button>
            </div>
        </div>
        
        <!-- Searching Page -->
        <div id="searching-page" class="hidden">
            <h1>Finding an opponent...</h1>
            <div style="margin: 30px 0;">
                <span class="loader"></span>
                <span>Searching for players</span>
            </div>
            <div class="buttons">
                <button id="cancel-search-btn" class="danger-btn">Cancel</button>
            </div>
        </div>
        
        <!-- Game Page -->
        <div id="game-page" class="hidden">
            <h1>Tic-Tac-Toe</h1>
            
            <div id="online-game-info" class="user-info hidden">
                <p>You (<span id="player-symbol">X</span>) vs <span id="opponent-nickname">Opponent</span> (<span id="opponent-symbol">O</span>)</p>
            </div>
            
            <div id="offline-game-info" class="user-info hidden">
                <p>Offline Mode: Player X vs Player O</p>
            </div>
            
            <div class="status-message" id="status-message"></div>
            
            <div class="game-board" id="game-board">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>
            
            <div class="score-board">
                <div class="score-item">
                    <div class="score-value" id="x-wins">0</div>
                    <div class="score-label">X Wins</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="o-wins">0</div>
                    <div class="score-label">O Wins</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="draws">0</div>
                    <div class="score-label">Draws</div>
                </div>
            </div>
            
            <div class="buttons">
                <button id="play-again-btn" class="primary-btn hidden">Play Again</button>
                <button id="back-to-main-btn" class="secondary-btn">Back to Main Menu</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-title">Game Over</h2>
            <p class="modal-message" id="modal-message">Message here</p>
            <div class="modal-buttons">
                <button id="modal-primary-btn" class="primary-btn">OK</button>
                <button id="modal-secondary-btn" class="secondary-btn hidden">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Utility functions
        function showPage(pageId) {
            document.querySelectorAll('.container > div').forEach(div => {
                div.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }
        
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.toggle('error', isError);
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        function showModal(title, message, primaryBtnText, primaryBtnCallback, secondaryBtnText = null, secondaryBtnCallback = null) {
            const modal = document.getElementById('modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            
            const primaryBtn = document.getElementById('modal-primary-btn');
            primaryBtn.textContent = primaryBtnText;
            primaryBtn.onclick = () => {
                modal.style.display = 'none';
                if (primaryBtnCallback) primaryBtnCallback();
            };
            
            const secondaryBtn = document.getElementById('modal-secondary-btn');
            if (secondaryBtnText) {
                secondaryBtn.textContent = secondaryBtnText;
                secondaryBtn.onclick = () => {
                    modal.style.display = 'none';
                    if (secondaryBtnCallback) secondaryBtnCallback();
                };
                secondaryBtn.classList.remove('hidden');
            } else {
                secondaryBtn.classList.add('hidden');
            }
            
            modal.style.display = 'flex';
        }
        
        // Generate random nickname
        function generateNickname() {
            const adjectives = ['Happy', 'Lucky', 'Clever', 'Brave', 'Swift', 'Wise', 'Jolly', 'Nimble', 'Bright', 'Kind'];
            const nouns = ['Panda', 'Tiger', 'Eagle', 'Wolf', 'Dolphin', 'Fox', 'Lion', 'Hawk', 'Bear', 'Whale'];
            const number = Math.floor(Math.random() * 1000);
            
            const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            
            return `${adjective}${noun}${number}`;
        }
        
        // Game logic
        class TicTacToe {
            constructor(offlineMode = true) {
                this.offlineMode = offlineMode;
                this.board = Array(9).fill('');
                this.currentPlayer = 'X';
                this.gameActive = true;
                this.winner = null;
                this.scores = { X: 0, O: 0, draws: 0 };
                this.playerSymbol = offlineMode ? 'X' : null; // For online mode, will be set later
                
                // DOM elements
                this.cells = document.querySelectorAll('.cell');
                this.statusMessage = document.getElementById('status-message');
                this.gameBoard = document.getElementById('game-board');
                
                // Bind events
                this.initGame();
            }
            
            initGame() {
                // Reset the board
                this.board = Array(9).fill('');
                this.currentPlayer = 'X';
                this.gameActive = true;
                this.winner = null;
                
                // Update UI
                this.cells.forEach(cell => {
                    cell.textContent = '';
                    cell.classList.remove('x', 'o');
                });
                
                // Set status message
                this.updateStatusMessage();
                
                // Attach event listeners
                this.cells.forEach(cell => {
                    cell.addEventListener('click', (e) => this.handleCellClick(e));
                });
                
                // Hide play again button initially
                document.getElementById('play-again-btn').classList.add('hidden');
                
                // Check if player should be allowed to make a move (in online mode)
                if (!this.offlineMode && this.playerSymbol !== this.currentPlayer) {
                    this.disableBoardInteraction();
                } else {
                    this.enableBoardInteraction();
                }
            }
            
            updateStatusMessage() {
                if (this.gameActive) {
                    const isPlayerTurn = this.offlineMode || (this.playerSymbol === this.currentPlayer);
                    this.statusMessage.textContent = isPlayerTurn ? 
                        `${this.currentPlayer}'s turn` : 
                        `Waiting for opponent's move...`;
                } else {
                    if (this.winner) {
                        const winnerText = this.offlineMode ? 
                            `Player ${this.winner} wins!` : 
                            (this.winner === this.playerSymbol ? 'You win!' : 'Opponent wins!');
                        this.statusMessage.textContent = winnerText;
                    } else {
                        this.statusMessage.textContent = "It's a draw!";
                    }
                    
                    // Show play again button
                    document.getElementById('play-again-btn').classList.remove('hidden');
                }
            }
            
            handleCellClick(event) {
                const cellIndex = event.target.dataset.index;
                
                // Check if the cell is already occupied or game is not active
                if (this.board[cellIndex] !== '' || !this.gameActive) {
                    return;
                }
                
                // In online mode, check if it's player's turn
                if (!this.offlineMode && this.playerSymbol !== this.currentPlayer) {
                    showNotification("It's not your turn yet", true);
                    return;
                }
                
                // Make the move
                this.makeMove(cellIndex);
                
                // In offline mode, continue with the game
                // In online mode, send move to server (simulated here)
                if (!this.offlineMode) {
                    this.simulateServerResponse(cellIndex);
                }
            }
            
            makeMove(cellIndex) {
                this.board[cellIndex] = this.currentPlayer;
                this.cells[cellIndex].textContent = this.currentPlayer;
                this.cells[cellIndex].classList.add(this.currentPlayer.toLowerCase());
                
                // Check for win or draw
                if (this.checkWin()) {
                    this.gameActive = false;
                    this.winner = this.currentPlayer;
                    this.scores[this.winner]++;
                    this.updateScoreBoard();
                } else if (this.checkDraw()) {
                    this.gameActive = false;
                    this.scores.draws++;
                    this.updateScoreBoard();
                } else {
                    // Switch players
                    this.currentPlayer = this.currentPlayer === 'X' ? 'O' : 'X';
                    
                    // In online mode, disable board if it's not player's turn
                    if (!this.offlineMode && this.playerSymbol !== this.currentPlayer) {
                        this.disableBoardInteraction();
                    }
                }
                
                // Update status message
                this.updateStatusMessage();
            }
            
            checkWin() {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                    [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                    [0, 4, 8], [2, 4, 6]             // diagonals
                ];
                
                return winPatterns.some(pattern => {
                    const [a, b, c] = pattern;
                    return this.board[a] && this.board[a] === this.board[b] && this.board[a] === this.board[c];
                });
            }
            
            checkDraw() {
                return this.board.every(cell => cell !== '');
            }
            
            updateScoreBoard() {
                document.getElementById('x-wins').textContent = this.scores.X;
                document.getElementById('o-wins').textContent = this.scores.O;
                document.getElementById('draws').textContent = this.scores.draws;
            }
            
            disableBoardInteraction() {
                this.gameBoard.style.pointerEvents = 'none';
                this.gameBoard.style.opacity = '0.8';
            }
            
            enableBoardInteraction() {
                this.gameBoard.style.pointerEvents = 'auto';
                this.gameBoard.style.opacity = '1';
            }
            
            // Simulate online opponent's move (for demo purposes)
            simulateServerResponse(playerMoveIndex) {
                // Disable board interaction while waiting for opponent
                this.disableBoardInteraction();
                
                // Simulate server delay
                setTimeout(() => {
                    if (!this.gameActive) {
                        // Game already ended
                        return;
                    }
                    
                    // If game is still active, simulate opponent's move
                    const availableMoves = [];
                    this.board.forEach((cell, index) => {
                        if (cell === '') availableMoves.push(index);
                    });
                    
                    if (availableMoves.length > 0) {
                        const randomMove = availableMoves[Math.floor(Math.random() * availableMoves.length)];
                        this.makeMove(randomMove);
                        
                        // Re-enable board if it's player's turn again
                        if (this.gameActive && this.playerSymbol === this.currentPlayer) {
                            this.enableBoardInteraction();
                        }
                    }
                }, 1000);
            }
        }
        
        // Application state
        let currentGame = null;
        let userNickname = generateNickname();
        let onlineUsersCount = Math.floor(Math.random() * 50) + 10; // Simulated
        let activeGamesCount = Math.floor(Math.random() * 20) + 5;  // Simulated
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Set user nickname
            document.getElementById('user-nickname').textContent = userNickname;
            
            // Simulate online stats update
            updateOnlineStats();
            setInterval(updateOnlineStats, 60000); // Update every minute
            
            // Set up event listeners
            document.getElementById('quick-game-btn').addEventListener('click', startQuickGame);
            document.getElementById('offline-game-btn').addEventListener('click', startOfflineGame);
            document.getElementById('cancel-search-btn').addEventListener('click', cancelSearch);
            document.getElementById('back-to-main-btn').addEventListener('click', backToMain);
            document.getElementById('play-again-btn').addEventListener('click', playAgain);
            
            // Show main page
            showPage('main-page');
        });
        
        function updateOnlineStats() {
            // Simulate fluctuations in online stats
            onlineUsersCount = Math.max(1, onlineUsersCount + Math.floor(Math.random() * 11) - 5);
            activeGamesCount = Math.max(0, activeGamesCount + Math.floor(Math.random() * 7) - 3);
            
            // Update UI
            document.getElementById('online-users-count').textContent = onlineUsersCount;
            document.getElementById('active-games-count').textContent = activeGamesCount;
            
            // Hide zero values
            document.getElementById('online-users-stat').style.display = onlineUsersCount > 0 ? 'block' : 'none';
            document.getElementById('active-games-stat').style.display = activeGamesCount > 0 ? 'block' : 'none';
        }
        
        function startQuickGame() {
            showPage('searching-page');
            
            // Simulate searching for opponent
            setTimeout(() => {
                // Hide searching page
                showPage('game-page');
                
                // Configure for online game
                document.getElementById('online-game-info').classList.remove('hidden');
                document.getElementById('offline-game-info').classList.add('hidden');
                
                // Randomly assign X or O to player
                const playerSymbol = Math.random() < 0.5 ? 'X' : 'O';
                const opponentSymbol = playerSymbol === 'X' ? 'O' : 'X';
                
                document.getElementById('player-symbol').textContent = playerSymbol;
                document.getElementById('opponent-symbol').textContent = opponentSymbol;
                
                // Generate opponent nickname
                const opponentNickname = generateNickname();
                document.getElementById('opponent-nickname').textContent = opponentNickname;
                
                // Start game
                currentGame = new TicTacToe(false);
                currentGame.playerSymbol = playerSymbol;
                
                // Show notification
                showNotification(`Match found! You're playing as ${playerSymbol}`);
                
                // If player is O, simulate X's first move
                if (playerSymbol === 'O') {
                    currentGame.simulateServerResponse();
                }
            }, 2000 + Math.random() * 3000); // Random wait time between 2-5 seconds
        }
        
        function startOfflineGame() {
            showPage('game-page');
            
            // Configure for offline game
            document.getElementById('online-game-info').classList.add('hidden');
            document.getElementById('offline-game-info').classList.remove('hidden');
            
            // Start the game
            currentGame = new TicTacToe(true);
        }
        
        function cancelSearch() {
            showPage('main-page');
            showNotification('Search cancelled');
        }
        
        function backToMain() {
            if (currentGame && !currentGame.offlineMode && currentGame.gameActive) {
                // Confirm before leaving online game
                showModal(
                    'Leave Game?',
                    'Are you sure you want to leave the current game? Your opponent will win by default.',
                    'Leave Game',
                    () => {
                        showPage('main-page');
                        showNotification('You left the game');
                    },
                    'Stay',
                    null
                );
            } else {
                showPage('main-page');
            }
        }
        
        function playAgain() {
            if (currentGame) {
                // For online game, check if opponent is still connected
                if (!currentGame.offlineMode) {
                    const opponentLeft = Math.random() < 0.3; // 30% chance opponent left
                    
                    if (opponentLeft) {
                        showModal(
                            'Opponent Left',
                            'Your opponent has left the game. Returning to main menu.',
                            'OK',
                            () => showPage('main-page')
                        );
                        return;
                    }
                }
                
                // Reset and start new game
                currentGame.initGame();
                
                // In online mode, if player is O, simulate X's first move
                if (!currentGame.offlineMode && currentGame.playerSymbol === 'O') {
                    currentGame.simulateServerResponse();
                }
            }
        }
        
        // Handle network errors (simulated)
        window.addEventListener('offline', () => {
            showNotification('Network connection lost. Please check your internet connection.', true);
            
            if (currentGame && !currentGame.offlineMode) {
                showModal(
                    'Connection Error',
                    'Lost connection to the game server. The game has ended.',
                    'Back to Main Menu',
                    () => showPage('main-page')
                );
            }
        });
    </script>
</body>
</html>
